-- parsequery.scpt-- Author: Jonas Neugebauer <dergimli@gmail.com>-- Version: 1.0-- log parse_query("#tag1 #tag2 My Title [Important project] ::This is very important >01.01.2012")(*Parses a query string of the form	#tag1 #tag2 title [project name] ::descr >due dateto a named list with	- tags: 		a list of tags as strings	- title:		the title as string	- project:		the project name as string	- descr:		the description as string	- due:		the due date as date objectEvery part except the name is optional and will be null in the result list if ommited (the tags will be an empty list)*)on parse_query(q)	set title to ""	set tags to []	set project to null	set descr to null	set due to null	set projMode to false	set descrMode to false	set AppleScript's text item delimiters to {" "}	set qElems to every text item of q	repeat with elem in qElems		set fc to character 1 of elem		set lc to character -1 of elem		if fc = ">" then			set descrMode to false			set d to text 2 thru -1 of elem as text			try				set due to date d			end try		else if fc = "#" then			set descrMode to false			set tag to text 2 thru -1 of elem as text			set tags to tags & [tag]		else if fc = "[" then			set descrMode to false			set projMode to true			if lc = "]" then				set project to (text 2 thru -2 of elem as text)				set projMode to false			else				set project to (text 2 thru -1 of elem as text)			end if		else if lc = "]" then			set projMode to false			set project to (project & space & (text 1 thru -2 of elem as text))		else if projMode = true then			set project to (project & space & elem)		else if fc = ":" and (character 2 of elem = ":") then			set descrMode to true			set descr to (text 3 thru -1 of elem as text)		else if descrMode = true then			set descr to (descr & space & elem)		else			if (count of title) = 0 then				set title to elem			else				set title to (title & space & elem)			end if		end if	end repeat	return {title:title, tags:tags, project:project, descr:descr, due:due}end parse_query